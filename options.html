<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <title>内容定制器 - 规则管理</title>
    <link rel="stylesheet" href="styles/options.css" />
  </head>
  <body>
    <div class="page">
      <header class="header">
        <div>
          <h1>内容定制器</h1>
          <p>针对特定 URL 管理文本、图片和样式替换规则</p>
        </div>
        <div class="io-controls">
          <button id="export-rules" type="button">📤 导出规则</button>
          <button id="import-rules" type="button">📥 导入规则</button>
          <!-- 添加设置按钮 -->
          <button id="settings-btn" type="button">⚙️ 设置</button>
          <input id="import-input" type="file" accept="application/json" hidden />
        </div>
      </header>

      <main class="layout">
        <section class="panel">
          <div class="panel-head">
            <div>
              <h2>规则列表</h2>
              <span id="rule-count" class="muted">共 0 条规则</span>
            </div>
            <button id="open-create" type="button" class="primary">+ 新建规则</button>
          </div>
          <div id="rules-empty" class="empty-state">
            <p>暂无规则，请使用右侧表单创建</p>
          </div>
          <table id="rules-table" class="rule-table" aria-label="规则列表">
            <thead>
              <tr>
                <th>名称</th>
                <th>模式</th>
                <th>方式</th>
                <th>状态</th>
                <th>操作</th>
              </tr>
            </thead>
            <tbody id="rules-table-body"></tbody>
          </table>
        </section>

        <section class="panel detail-panel collapsed" id="detail-panel">
          <div class="panel-head">
            <h2 id="form-title">创建规则</h2>
            <button id="cancel-edit" type="button" class="link-button">
              收起
            </button>
          </div>
          <div id="form-placeholder" class="placeholder">
            请选择左侧规则或点击"新建规则"打开详情
          </div>
          <form id="rule-form" hidden>
            <label>
              规则名称
              <input type="text" id="rule-name" required placeholder="例如：产品详情页微调" />
            </label>

            <label>
              URL 模式
              <input
                type="text"
                id="rule-pattern"
                required
                placeholder="https://example.com/*"
              />
            </label>

            <label>
              匹配方式
              <select id="rule-match-type">
                <option value="exact">精确匹配</option>
                <option value="contains">包含路径</option>
                <option value="wildcard" selected>通配符（* 任意字符）</option>
                <option value="regex">正则表达式</option>
              </select>
            </label>

            <label class="checkbox">
              <input type="checkbox" id="rule-enabled" checked />
              启用此规则
            </label>

            <label class="checkbox">
              <input type="checkbox" id="rule-ignore-case" checked />
              忽略 URL 匹配大小写
            </label>

            <details class="advanced-settings">
              <summary class="advanced-toggle">⚙️ 高级设置</summary>
              <div class="advanced-content">
                <label>
                  首屏处理
                  <select id="rule-preload-mode">
                    <option value="hide">隐藏原内容后展示（推荐）</option>
                    <option value="compile">仅预编译（不隐藏）</option>
                    <option value="off">关闭预处理</option>
                  </select>
                </label>
                <p class="muted" style="font-size: 0.85rem; margin-top: 8px;">
                  隐藏原内容可避免页面闪烁，预处理可提升性能
                </p>
              </div>
            </details>

            <fieldset>
              <legend>
                文本替换
                <span id="text-count" class="count-chip">0 条</span>
              </legend>
              <div id="text-replacements" class="replacement-list"></div>
              <button id="add-text-replacement" type="button" class="secondary">
                ➕ 添加文本替换
              </button>
            </fieldset>

            <fieldset>
              <legend>
                图片替换
                <span id="image-count" class="count-chip">0 条</span>
              </legend>
              <div id="image-replacements" class="replacement-list"></div>
              <button id="add-image-replacement" type="button" class="secondary">
                ➕ 添加图片替换
              </button>
            </fieldset>

            <fieldset>
              <legend>
                样式替换
              </legend>
              <div class="full-width">
                <label>
                  CSS样式
                  <textarea id="css-rules" rows="10" placeholder="/* 在这里输入CSS样式，就像编写CSS文件一样 */
.card {
  background: #ff6b6b;
  border: 1px solid #ffa500;
  border-radius: 8px;
  padding: 16px;
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

.header {
  color: #2c3e50;
  font-size: 20px;
  font-weight: bold;
  text-align: center;
}"></textarea>
                </label>
              </div>
            </fieldset>

            <div class="form-actions">
              <button type="submit" class="primary">💾 保存规则</button>
            </div>
          </form>
        </section>
      </main>

      <!-- 添加设置弹窗 -->
      <div id="settings-modal" class="modal" hidden>
        <div class="modal-content">
          <div class="modal-header">
            <h2>⚙️ 设置</h2>
            <button id="close-settings" class="close-button">&times;</button>
          </div>
          <div class="modal-body">
            <fieldset>
              <legend>数据同步</legend>
              <label>
                存储方式
                <select id="storage-method">
                  <option value="local">本地存储</option>
                  <option value="sync">同步存储</option>
                </select>
              </label>
              <p class="muted" style="font-size: 0.85rem; margin-top: 8px;">
                同步存储可在不同设备间共享规则，但有容量限制
              </p>
            </fieldset>
            
            <div class="modal-actions">
              <button id="save-settings" class="primary">保存设置</button>
              <button id="cancel-settings" class="secondary">取消</button>
            </div>
          </div>
        </div>
      </div>

      <output id="status" role="status" class="status" aria-live="polite"></output>
    </div>
    <script type="module" src="options.js"></script>
  </body>
</html>