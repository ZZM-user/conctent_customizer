# 📝 Chrome 扩展程序产品需求文档 (PRD)

## 🎯 1. 产品概述与目标

| 字段 | 内容 |
| :--- | :--- |
| **产品名称** | Content Customizer（暂定） |
| **产品类型** | Chrome 扩展程序（Extension） |
| **核心目标** | 允许用户为特定 URL 定义和应用持久的内容替换规则，以个性化和优化浏览体验。 |
| **目标用户** | 对特定网站内容有自定义需求的用户；需要进行本地内容测试或演示的开发者。 |
| **Manifest 规范** | Manifest V3 (MV3) |

## ✨ 2. 核心功能与用户故事

### 2.1 替换规则管理 (管理后台/选项页)

| ID | 功能描述 | 用户故事 | 优先级 |
| :--- | :--- | :--- | :--- |
| **F01** | **规则列表** | 作为用户，我想要查看、编辑和删除我创建的所有替换规则列表。 | 必须 |
| **F02** | **创建新规则** | 作为用户，我想要为**一个新的 URL 或 URL 模式**创建一套替换规则。 | 必须 |
| **F03** | **URL 匹配模式** | 作为用户，我希望能够选择精确 URL 匹配、部分路径匹配或使用通配符 (`*`) 进行模糊匹配。 | 必须 |
| **F04** | **启用/禁用** | 作为用户，我想要快速启用或禁用某一整套规则，而不必删除它们。 | 必须 |
| **F05** | **规则导入/导出** | 作为用户，我希望将我的规则导出为 JSON 文件，以便备份或分享给他人。 | 很高 |

### 2.2 替换内容定义

| ID | 功能描述 | 用户故事 | 优先级 |
| :--- | :--- | :--- | :--- |
| **F06** | **文字替换** | 作为用户，我想要设置“查找文本”和“替换为”文本的对应关系。 | 必须 |
| **F07** | **图片替换** | 作为用户，我想要指定一个图片的 URL，并将其替换为另一个本地文件路径或外部图片 URL。 | 必须 |
| **F08** | **正则表达式支持** | 作为高级用户，我想要使用正则表达式进行文字查找和替换，以应对复杂的匹配场景。 | 很高 |

### 2.3 实时操作与用户体验 (Popup/悬浮窗)

| ID | 功能描述 | 用户故事 | 优先级 |
| :--- | :--- | :--- | :--- |
| **F09** | **当前页面状态显示** | 作为用户，我想要在点击扩展程序图标时，立即看到当前页面的 URL 是否有激活的替换规则。 | 必须 |
| **F10** | **快速开关** | 作为用户，我想要在 Popup 中快速关闭或开启当前 URL 激活的规则，以便进行对比查看。 | 必须 |
| **F11** | **一键创建** | 作为用户，我想要在 Popup 中点击一个按钮，直接跳转到选项页并预填充当前的 URL，快速创建规则。 | 必须 |

---

## 💻 3. 技术要求与实现策略

### 3.1 核心技术栈

* **前端:** HTML/CSS/JavaScript
* **扩展程序 API:** Chrome Extension API (Manifest V3)
* **持久化存储:** `chrome.storage.local` 用于存储替换规则。

### 3.2 性能与实时性（关键）

| 策略 | 目的 | 详情 |
| :--- | :--- | :--- |
| **Content Script 注入时机** | 实现最快的替换。 | `manifest.json` 中配置 Content Script 的 `run_at` 属性为 **`document_start`**。 |
| **实时监听机制** | 确保动态加载的内容也能被替换。 | 在 Content Script 中，使用 **`MutationObserver`** API 监听目标网站的 DOM 变化。  |
| **性能优化** | 避免高 CPU 消耗。 | 在 `MutationObserver` 的回调函数中，采用 **Debouncing（去抖动）** 策略，将多次 DOM 变化合并为单次替换操作。 |

### 3.3 架构和通信

| 组件 | 职责 | 通信方式 |
| :--- | :--- | :--- |
| **Background Script** | 规则的 CRUD（创建、读取、更新、删除）操作、持久化存储和规则匹配逻辑。 | 消息传递 (Message Passing) |
| **Popup Script** | 显示当前页面的规则状态，控制快速开关。 | 消息传递 (Message Passing) |
| **Content Script** | 获取当前 URL 匹配的规则，并在目标网站 DOM 中执行替换操作。 | 消息传递 (Message Passing) |

---

## 🔒 4. 审核与政策合规性（重点）

为了确保顺利上架 Chrome Web Store，必须满足以下要求：

1.  **权限最小化：**
    * **必须权限：** `storage` (存储规则)、`activeTab` 或针对特定域名的 `host_permissions`。
    * **避免：** 除非有充分理由，否则避免请求 `https://*/*` 的全局权限。
2.  **用户隐私：** 必须在应用商店列表页提供清晰的**隐私政策**，说明所有替换规则仅存储在用户本地设备，不进行任何远程收集、共享或传输。
3.  **功能透明度：** 扩展程序必须具有清晰的**用户界面**（F09, F10），向用户明确告知替换正在发生，并提供关闭选项。
4.  **无恶意行为：** 绝不能在网站上注入无关的广告或进行任何欺骗性的内容修改。

---

## 🖼️ 5. UI/UX 简单原型（草图）

1.  **Popup 页面：** 顶部显示当前 URL。下方显示当前 URL 匹配的规则名称和一键**[开启/关闭]**按钮。底部有一个**[前往规则管理]**按钮。
2.  **选项页（规则管理）：** 以表格形式列出所有规则：`规则名称 | URL 匹配模式 | 状态 | 操作（编辑/删除）`。点击**[编辑]**进入详细的文本/图片替换列表。